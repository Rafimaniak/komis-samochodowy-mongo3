<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Nieużywane zdjęcia</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .used { background-color: #d4edda; }
        .unused { background-color: #f8d7da; }
        .image-preview { max-width: 100px; max-height: 100px; }
    </style>
</head>
<body>
<div class="container mt-4">
    <h1>Zarządzanie zdjęciami samochodów</h1>

    <div th:if="${success}" class="alert alert-success">
        [[${success}]]
    </div>
    <div th:if="${warning}" class="alert alert-warning">
        [[${warning}]]
    </div>
    <div th:if="${error}" class="alert alert-danger">
        [[${error}]]
    </div>

    <div class="card mb-4">
        <div class="card-header">
            Statystyki
        </div>
        <div class="card-body">
            <p>Wszystkie zdjęcia: <strong>[[${liczbaWszystkich}]]</strong></p>
            <p>Używane zdjęcia: <strong>[[${liczbaUzywanych}]]</strong></p>
            <p>Nieużywane zdjęcia: <strong>[[${liczbaNieuzywanych}]]</strong></p>
            <p class="text-danger">Potencjalna oszczędność miejsca: obliczana z nieużywanych zdjęć</p>
        </div>
    </div>

    <div class="mb-4">
        <a th:href="@{/admin/cleanup/auto-cleanup}" class="btn btn-danger me-2"
           onclick="return confirm('Czy na pewno chcesz usunąć WSZYSTKIE nieużywane zdjęcia?')">
            Automatyczne czyszczenie
        </a>
        <a th:href="@{/admin/panel}" class="btn btn-secondary">Powrót do panelu</a>
    </div>

    <h3>Nieużywane zdjęcia</h3>
    <form th:action="@{/admin/cleanup/delete-unused-images}" method="post"
          onsubmit="return confirm('Czy na pewno chcesz usunąć wybrane zdjęcia?')">
        <table class="table table-bordered">
            <thead>
            <tr>
                <th><input type="checkbox" id="selectAll"></th>
                <th>Zdjęcie</th>
                <th>Nazwa pliku</th>
                <th>Rozmiar</th>
                <th>Data modyfikacji</th>
                <th>Status</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="zdjecie : ${nieuzywaneZdjecia}" class="table-danger">
                <td>
                    <input type="checkbox" name="images" th:value="${zdjecie.nazwa}">
                </td>
                <td>
                    <img th:src="@{'/images/samochody/' + ${zdjecie.nazwa}}"
                         alt="Podgląd" class="image-preview">
                </td>
                <td>[[${zdjecie.nazwa}]]</td>
                <td>[[${zdjecie.rozmiarMB}]]</td>
                <td>[[${#dates.format(zdjecie.dataModyfikacji, 'dd/MM/yyyy HH:mm')}]]</td>
                <td><span class="badge bg-danger">Nieużywane</span></td>
            </tr>
            </tbody>
        </table>

        <button type="submit" class="btn btn-danger" th:disabled="${liczbaNieuzywanych} == 0">
            Usuń wybrane zdjęcia
        </button>
    </form>

    <h3 class="mt-5">Wszystkie zdjęcia</h3>
    <table class="table table-bordered">
        <thead>
        <tr>
            <th>Zdjęcie</th>
            <th>Nazwa pliku</th>
            <th>Rozmiar</th>
            <th>Data modyfikacji</th>
            <th>Status</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="zdjecie : ${wszystkieZdjecia}"
            th:class="${zdjecie.uzywane} ? 'used' : 'unused'">
            <td>
                <img th:src="@{'/images/samochody/' + ${zdjecie.nazwa}}"
                     alt="Podgląd" class="image-preview">
            </td>
            <td>[[${zdjecie.nazwa}]]</td>
            <td>[[${zdjecie.rozmiarMB}]]</td>
            <td>[[${#dates.format(zdjecie.dataModyfikacji, 'dd/MM/yyyy HH:mm')}]]</td>
            <td>
                <span th:if="${zdjecie.uzywane}" class="badge bg-success">Używane</span>
                <span th:unless="${zdjecie.uzywane}" class="badge bg-danger">Nieużywane</span>
            </td>
        </tr>
        </tbody>
    </table>
</div>

<script>
    // Skrypt do zaznaczania wszystkich checkboxów
    document.getElementById('selectAll').addEventListener('click', function() {
        const checkboxes = document.querySelectorAll('input[name="images"]');
        checkboxes.forEach(checkbox => {
            checkbox.checked = this.checked;
        });
    });
</script>
</body>
</html>